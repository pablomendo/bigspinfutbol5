const SHEET_ID = '1nJMn9kyf_c4AFsmqD5cjjC4_-ggdWukV';
const SHEET_NAME = 'Hoja 1'; // IMPORTANTE: El nombre de tu pestaña debe ser 'Hoja 1'

function doGet(e) {
  const action = e.parameter.action;
  if (action === 'getReservations') {
    return getReservations();
  }
  return ContentService.createTextOutput(JSON.stringify({ error: 'Acción GET no válida' })).setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  const action = e.parameter.action;
  if (action === 'addReservation') {
    return addReservation(e.parameter);
  }
  return ContentService.createTextOutput(JSON.stringify({ error: 'Acción POST no válida' })).setMimeType(ContentService.MimeType.JSON);
}


function getReservations() {
  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);
  const lastRow = sheet.getLastRow();
  
  if (lastRow < 2) {
    return ContentService.createTextOutput(JSON.stringify([])).setMimeType(ContentService.MimeType.JSON);
  }
  
  // Columnas A, B, C, D, E: Fecha, Hora, Cancha, Nombre, Teléfono
  const range = sheet.getRange(2, 1, lastRow - 1, 5);
  const values = range.getValues();

  return ContentService.createTextOutput(JSON.stringify(values)).setMimeType(ContentService.MimeType.JSON);
}

function addReservation(data) {
  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);
  
  const newRow = [
    data.date,         // Columna A
    data.time,         // Columna B
    data.court,        // Columna C
    data.name,         // Columna D
    data.phone,        // Columna E
    new Date()         // Columna F (Marca de tiempo)
  ];
  
  sheet.appendRow(newRow);
  
  return ContentService.createTextOutput(JSON.stringify({ success: true })).setMimeType(ContentService.MimeType.JSON);
}
